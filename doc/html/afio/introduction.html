<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<title>Introduction</title>
<link rel="stylesheet" href="../../../libs/afio/doc/html/myboostbook.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.76.1">
<link rel="home" href="../afio.html" title="Chapter&#160;1.&#160;Boost.AFIO 1.30">
<link rel="up" href="../afio.html" title="Chapter&#160;1.&#160;Boost.AFIO 1.30">
<link rel="prev" href="../afio.html" title="Chapter&#160;1.&#160;Boost.AFIO 1.30">
<link rel="next" href="design.html" title="Design Rationale">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<table cellpadding="2" width="100%"><tr>
<td valign="top"><img alt="Boost C++ Libraries" width="277" height="86" src="../../../boost.png"></td>
<td align="center"><a href="../../../index.html">Home</a></td>
<td align="center"><a href="../../../libs/libraries.htm">Libraries</a></td>
<td align="center"><a href="http://www.boost.org/users/people.html">People</a></td>
<td align="center"><a href="http://www.boost.org/users/faq.html">FAQ</a></td>
<td align="center"><a href="../../../more/index.htm">More</a></td>
</tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="../afio.html"><img src="../../../doc/src/images/prev.png" alt="Prev"></a><a accesskey="u" href="../afio.html"><img src="../../../doc/src/images/up.png" alt="Up"></a><a accesskey="h" href="../afio.html"><img src="../../../doc/src/images/home.png" alt="Home"></a><a accesskey="n" href="design.html"><img src="../../../doc/src/images/next.png" alt="Next"></a>
</div>
<div class="section">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="afio.introduction"></a><a class="link" href="introduction.html" title="Introduction">Introduction</a>
</h2></div></div></div>
<p>
      Boost.AFIO is a C++ library which lets you schedule an ordered dependency graph
      of file input/output operations to be executed asynchronously to the maximum
      capacity of your hardware. If you want to do portable asynchronous file i/o
      in C++, especially if you need to easily order issues of reads and writes,
      this is the correct library to be looking at.
    </p>
<p>
      Boost.AFIO is a Boost.BindLib based Boost library, and therefore is capable
      of any combination of the following build configurations:
    </p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem">
          Uses either Boost OR the C++ 11 STL for atomic, thread, future, chrono
          etc.
        </li>
<li class="listitem">
          Uses either Boost OR the C++ 1y STL for Fileystem. At the time of writing,
          only VS2015 provides Filesystem in its STL.
        </li>
<li class="listitem">
          Uses either Boost OR standalone ASIO for the i/o engine.
        </li>
</ul></div>
<p>
      You may note that as a result AFIO can be used as a completely standalone header-only
      library totally independent from any dependencies on Boost which can be dropped
      into any existing build system as a simple single header include. This, incidentally,
      also extends to its unit test suite which can use either <a href="http://www.boost.org/libs/iostreams/" target="_top">Boost.Test</a>
      OR <a href="https://github.com/philsquared/Catch" target="_top">https://github.com/philsquared/Catch</a>.
    </p>
<p>
      Boost.AFIO provides a pure portable POSIX file i/o backend and specialised
      file i/o backends making use of host OS asynchronous file i/o facilities are
      provided for:
    </p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem">
          Windows NT IOCP (since v1.0)
        </li>
<li class="listitem">
          Linux KAIO (planned for v1.x)
        </li>
<li class="listitem">
          POSIX AIO, suitable for BSD only (planned for v1.x)
        </li>
</ul></div>
<p>
      Boost.AFIO extends <a href="http://www.boost.org/libs/asio/" target="_top">Boost.ASIO</a>
      and provides an alternative way of programming with ASIO. Implementation of
      this first version has been kept as simple as possible (~ 1000 active LOC)
      at the cost of some performance, though with a good modern compiler <a class="link" href="FAQ/closure_performance.html" title="What is the maximum throughput of AFIO's closure execution engine aka how many IOPS can I push with AFIO?">you
      can expect 50-70% of the throughput of using raw Boost.ASIO</a> at a latency
      of <a class="link" href="FAQ/closure_latency.html" title="What is the latency of AFIO's closure execution engine aka how quickly can I push a single op with AFIO?">about 10,000 CPU cycles to get
      notified of the completion of an operation</a>. This library was brought
      to Boost as part of Google Summer of Code 2013.
    </p>
<p>
      Note that Boost.AFIO is a C++ 11 only library, and it requires, as an absolute
      minimum, a compiler with:
    </p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem">
          Rvalue reference support.
        </li>
<li class="listitem">
          Variadic templates.
        </li>
<li class="listitem">
          Template aliasing.
        </li>
</ul></div>
<p>
      Some popular compilers known to be minimally sufficient thanks to <a href="https://ci.nedprod.com/" target="_top">our
      Jenkins CI bot</a> include:
    </p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem">
          Microsoft Visual Studio 2013, released in 2013. Before v1.3 of the engine
          VS2010 was supported.
        </li>
<li class="listitem">
          GNU Compiler Collection v4.7, released in 2012. Before v1.3 of the engine
          GCC 4.6 was known to work.
        </li>
<li class="listitem">
          clang v3.2, released in 2012. clang v3.1 is known to produce segfaulting
          binaries.
        </li>
</ul></div>
<p>
      The Jenkins CI bot runs a full set of unit tests for all supported compilers
      on all supported platforms for every single commit to master branch and every
      single pull request. Additionally, the Travis CI bot runs a full set of code
      coverage for the unit tests, plus a pass of the clang 3.4 Thread Sanitizer
      over all the unit tests, also for every single commit and pull request. As
      of AFIO v1.2, it is rare to see anything except all green on the CI dashboard.
      <a class="link" href="compilation.html#unit_test_dashboard">You can view the build and unit test CI
      dashboard for all compilers and platforms here</a>.
    </p>
<p>
      Note that just because a compiler will compile the code does not mean performance
      will be good! All Visual Studios, including 2015, have problems optimising
      AFIO to a good extent, indeed 2015 current produces slightly slower code than
      2013.
    </p>
<div class="important"><table border="0" summary="Important">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="../../../doc/src/images/important.png"></td>
<th align="left">Important</th>
</tr>
<tr><td align="left" valign="top"><p>
        Note that Boost.AFIO has not passed Boost peer review, and therefore is not
        a part of the Boost C++ libraries
      </p></td></tr>
</table></div>
<p>
      As a very quick example of minimal usage:
    </p>
<pre class="programlisting"><span class="comment">// Create a dispatcher instance</span>
<span class="keyword">auto</span> <span class="identifier">dispatcher</span><span class="special">=</span><span class="identifier">boost</span><span class="special">::</span><span class="identifier">afio</span><span class="special">::</span><span class="identifier">make_async_file_io_dispatcher</span><span class="special">();</span>

<span class="comment">// Schedule an asynchronous call of some function with some bound set of arguments</span>
<span class="keyword">auto</span> <span class="identifier">helloworld</span><span class="special">=</span><span class="identifier">dispatcher</span><span class="special">-&gt;</span><span class="identifier">call</span><span class="special">(</span><span class="identifier">boost</span><span class="special">::</span><span class="identifier">afio</span><span class="special">::</span><span class="identifier">async_io_op</span><span class="special">()</span> <span class="comment">/* no precondition */</span><span class="special">,</span> <span class="special">[](</span><span class="identifier">std</span><span class="special">::</span><span class="identifier">string</span> <span class="identifier">text</span><span class="special">)</span> <span class="special">-&gt;</span> <span class="keyword">int</span> <span class="special">{</span>
    <span class="identifier">std</span><span class="special">::</span><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="identifier">text</span> <span class="special">&lt;&lt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">endl</span><span class="special">;</span>
    <span class="keyword">return</span> <span class="number">42</span><span class="special">;</span>
<span class="special">},</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">string</span><span class="special">(</span><span class="string">"Hello world"</span><span class="special">));</span> <span class="comment">// Returns a pair of &lt;future, op ref&gt;</span>

<span class="comment">// Schedule as asynchronous call of some function to occur only after helloworld completes</span>
<span class="keyword">auto</span> <span class="identifier">addtovalue</span><span class="special">=</span><span class="identifier">dispatcher</span><span class="special">-&gt;</span><span class="identifier">call</span><span class="special">(</span><span class="identifier">helloworld</span><span class="special">.</span><span class="identifier">second</span><span class="special">,</span> <span class="special">[](</span><span class="identifier">boost</span><span class="special">::</span><span class="identifier">afio</span><span class="special">::</span><span class="identifier">shared_future</span><span class="special">&lt;</span><span class="keyword">int</span><span class="special">&gt;</span> <span class="identifier">v</span><span class="special">)</span> <span class="special">-&gt;</span> <span class="keyword">int</span> <span class="special">{</span>
    <span class="comment">// v is highly likely to be ready very soon by the time we are called</span>
    <span class="keyword">return</span> <span class="identifier">v</span><span class="special">.</span><span class="identifier">get</span><span class="special">()+</span><span class="number">1</span><span class="special">;</span>
<span class="special">},</span> <span class="identifier">helloworld</span><span class="special">.</span><span class="identifier">first</span><span class="special">);</span>

<span class="comment">// Create a boost::future&lt;&gt; representing the ops passed to when_all()</span>
<span class="keyword">auto</span> <span class="identifier">future</span><span class="special">=</span><span class="identifier">boost</span><span class="special">::</span><span class="identifier">afio</span><span class="special">::</span><span class="identifier">when_all</span><span class="special">(</span><span class="identifier">addtovalue</span><span class="special">.</span><span class="identifier">second</span><span class="special">);</span>
<span class="comment">// ... and wait for it to complete</span>
<span class="identifier">future</span><span class="special">.</span><span class="identifier">wait</span><span class="special">();</span>

<span class="comment">// Print the result returned by the future for the lambda, which will be 43</span>
<span class="identifier">std</span><span class="special">::</span><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="string">"addtovalue() returned "</span> <span class="special">&lt;&lt;</span> <span class="identifier">addtovalue</span><span class="special">.</span><span class="identifier">first</span><span class="special">.</span><span class="identifier">get</span><span class="special">()</span> <span class="special">&lt;&lt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">endl</span><span class="special">;</span>
</pre>
</div>
<table xmlns:rev="http://www.cs.rpi.edu/~gregod/boost/tools/doc/revision" width="100%"><tr>
<td align="left"></td>
<td align="right"><div class="copyright-footer">Copyright &#169; 2013-2015 Niall Douglas
      and Paul Kirth<p>
        Distributed under the Boost Software License, Version 1.0. (See accompanying
        file LICENSE_1_0.txt or copy at <a href="http://www.boost.org/LICENSE_1_0.txt" target="_top">http://www.boost.org/LICENSE_1_0.txt</a>)
      </p>
</div></td>
</tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="../afio.html"><img src="../../../doc/src/images/prev.png" alt="Prev"></a><a accesskey="u" href="../afio.html"><img src="../../../doc/src/images/up.png" alt="Up"></a><a accesskey="h" href="../afio.html"><img src="../../../doc/src/images/home.png" alt="Home"></a><a accesskey="n" href="design.html"><img src="../../../doc/src/images/next.png" alt="Next"></a>
</div>
</body>
</html>
